extends ../base

append addonjs
	script(src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false")
	if event.address != null || event.geo != null
		script.
			var map = new google.maps.Map(document.getElementById('eventMap'), {
				zoom:5,
				mapTypeId: google.maps.MapTypeId.ROADMAP
			});
		if event.geo != null
			script.
				function preInitialize() {
					var location = new google.maps.LatLng(#{event.geo.geo.lat}, #{event.geo.geo.lng});
					initialize(location)	
				}
		else if event.address != null
			//- geolocate the address
			script.
				function preInitialize() {
					geocoder = new google.maps.Geocoder();
					geocoder.geocode({ address: "#{event.address}" }, function(results, status) {
						if (status == google.maps.GeocoderStatus.OK) {
							initialize(results[0].geometry.location);
						}
					});
				}
			
		script.
			
			function initialize(location) {
				map.setCenter(location);
				map.setZoom(12);
				
				var marker = new google.maps.Marker({
					map: map,
					position: location
				});
				var infowindow = new google.maps.InfoWindow;
			
				var content = '<div class="map-content"><h3>#{event.name}</h3>#{event.address}<br /><a href="http://maps.google.com/?daddr=#{event.address}" target="_blank">Get Directions</a></div>';
				infowindow.setContent(content);
				google.maps.event.addListener(
					marker, 
					'click', 
					infoCallback(infowindow, marker)
				);
			
				function infoCallback(infowindow, marker) {
					return function() {
						infowindow.open(map, marker);
					};
				}
			};
			google.maps.event.addDomListener(window, 'load', preInitialize);

block content
	include landingpage
	
	//if eventattending
	//	include homepage
	//else
	//	include landingpage				